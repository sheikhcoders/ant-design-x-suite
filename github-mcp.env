# GitHub MCP Environment Variables for OpenCode Global Configuration
# Source this file to set up MCP environment: source ~/.github-mcp.env

# Core MCP Configuration
export GITHUB_MCP_PROVIDER="opencode"
export GITHUB_MCP_BASE_URL="https://opencode.ai/zen/v1"
export GITHUB_MCP_MODEL="glm-4.7-free"
export GITHUB_MCP_DEFAULT_MODEL="glm-4.7-free"

# MCP Capabilities
export GITHUB_MCP_THINKING_ENABLED="true"
export GITHUB_MCP_STREAMING_ENABLED="true"
export GITHUB_MCP_CODE_COMPLETION="true"
export GITHUB_MCP_DOCUMENTATION="true"

# API Configuration
export GITHUB_MCP_TIMEOUT="30000"
export GITHUB_MCP_MAX_TOKENS="2000"
export GITHUB_MCP_TEMPERATURE="0.7"
export GITHUB_MCP_FREQUENCY_PENALTY="0"
export GITHUB_MCP_PRESENCE_PENALTY="0"

# OpenCode API Key (set this manually)
# export OPENCODE_API_KEY="your_opencode_api_key_here"

# Available Models
export GITHUB_MCP_MODELS="glm-4.7-free,kimi-k2.5-free,minimax-m2.1-free,big-pickle"

# MCP Features
export GITHUB_MCP_REASONING="true"
export GITHUB_MCP_MULTIMODAL="false"
export GITHUB_MCP_FUNCTION_CALLING="true"

# Debug and Logging
export GITHUB_MCP_DEBUG="false"
export GITHUB_MCP_LOG_LEVEL="info"

# MCP Server Configuration
export GITHUB_MCP_SERVER_PATH="/usr/local/bin/gh-mcp-server"
export GITHUB_MCP_CONFIG_PATH="$HOME/.config/gh/mcp.yml"

# Function to verify MCP setup
verify_mcp_setup() {
    echo "ðŸ” Verifying GitHub MCP Setup..."
    echo "Provider: $GITHUB_MCP_PROVIDER"
    echo "Model: $GITHUB_MCP_MODEL"
    echo "Thinking: $GITHUB_MCP_THINKING_ENABLED"
    echo "Streaming: $GITHUB_MCP_STREAMING_ENABLED"
    
    if command -v gh &> /dev/null; then
        echo "âœ… GitHub CLI installed: $(gh version --json version | jq -r '.version' 2>/dev/null || echo 'unknown')"
    else
        echo "âŒ GitHub CLI not found"
    fi
    
    if [ -n "$OPENCODE_API_KEY" ]; then
        echo "âœ… OpenCode API key configured"
    else
        echo "âš ï¸  OpenCode API key not set"
    fi
}

# Function to test MCP connection
test_mcp_connection() {
    echo "ðŸ§ª Testing MCP Connection..."
    
    if [ -z "$OPENCODE_API_KEY" ]; then
        echo "âŒ OpenCode API key not configured"
        return 1
    fi
    
    # Test API connection
    curl -s -H "Authorization: Bearer $OPENCODE_API_KEY" \
         -H "Content-Type: application/json" \
         -d '{"model": "glm-4.7-free", "messages": [{"role": "user", "content": "Hello"}], "stream": false}' \
         "$GITHUB_MCP_BASE_URL/chat/completions" > /dev/null
    
    if [ $? -eq 0 ]; then
        echo "âœ… OpenCode API connection successful"
        return 0
    else
        echo "âŒ OpenCode API connection failed"
        return 1
    fi
}

# Display MCP status
mcp_status() {
    echo "ðŸ“Š GitHub MCP Status:"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "Provider:     $GITHUB_MCP_PROVIDER"
    echo "Base URL:     $GITHUB_MCP_BASE_URL"
    echo "Model:        $GITHUB_MCP_MODEL"
    echo "Thinking:     $GITHUB_MCP_THINKING_ENABLED"
    echo "Streaming:    $GITHUB_MCP_STREAMING_ENABLED"
    echo "Timeout:      $GITHUB_MCP_TIMEOUT ms"
    echo "Max Tokens:   $GITHUB_MCP_MAX_TOKENS"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
}

# Auto-completion setup
if [ -n "$BASH_VERSION" ]; then
    complete -W "status test verify" mcp_status 2>/dev/null
    complete -W "status test verify" test_mcp_connection 2>/dev/null
    complete -W "status test verify" verify_mcp_setup 2>/dev/null
fi

echo "âœ… GitHub MCP Environment loaded successfully!"
echo "ðŸ“– Available functions:"
echo "   - verify_mcp_setup    : Verify MCP configuration"
echo "   - test_mcp_connection : Test OpenCode API connection"
echo "   - mcp_status          : Display current MCP status"